


<!DOCTYPE html>
<html>
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# githubog: http://ogp.me/ns/fb/githubog#">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>homoiconic/2010/10/let.md at master · raganwald/homoiconic · GitHub</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub" />
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub" />
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-114.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-144.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144.png" />
    <link rel="logo" type="image/svg" href="https://github-media-downloads.s3.amazonaws.com/github-logo.svg" />
    <meta property="og:image" content="https://github.global.ssl.fastly.net/images/modules/logos_page/Octocat.png">
    <meta name="hostname" content="fe3.rs.github.com">
    <link rel="assets" href="https://github.global.ssl.fastly.net/">
    <link rel="xhr-socket" href="/_sockets" />
    
    


    <meta name="msapplication-TileImage" content="/windows-tile.png" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="selected-link" value="repo_source" data-pjax-transient />
    <meta content="collector.githubapp.com" name="octolytics-host" /><meta content="github" name="octolytics-app-id" />

    
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <meta content="authenticity_token" name="csrf-param" />
<meta content="tiyNVzowJuHJaEnZpa45WvHZCo3DRWGmw9b1+OmmxW8=" name="csrf-token" />

    <link href="https://github.global.ssl.fastly.net/assets/github-c6ca95663cba6496fe7a5bdd98671b82cd956df3.css" media="all" rel="stylesheet" type="text/css" />
    <link href="https://github.global.ssl.fastly.net/assets/github2-d35b02ba3940bde9b9f2c3e58f2dfb1ceff5886c.css" media="all" rel="stylesheet" type="text/css" />
    


      <script src="https://github.global.ssl.fastly.net/assets/frameworks-eae23340ab2a6ba722166712e699c87aaf60ad8f.js" type="text/javascript"></script>
      <script src="https://github.global.ssl.fastly.net/assets/github-9339835a99ecd32fb1a6de9d7d9bf56f272a0b39.js" type="text/javascript"></script>
      
      <meta http-equiv="x-pjax-version" content="7bb0bd2d60adf37e0211fafb1d0d1ba9">

        <link data-pjax-transient rel='permalink' href='/raganwald/homoiconic/blob/614d364f75bb82407d9e66ed66e2817c961b10b0/2010/10/let.md'>
  <meta property="og:title" content="homoiconic"/>
  <meta property="og:type" content="githubog:gitrepository"/>
  <meta property="og:url" content="https://github.com/raganwald/homoiconic"/>
  <meta property="og:image" content="https://github.global.ssl.fastly.net/images/gravatars/gravatar-user-420.png"/>
  <meta property="og:site_name" content="GitHub"/>
  <meta property="og:description" content="homoiconic - An experiment in publishing code and words about code on a small scale."/>

  <meta name="description" content="homoiconic - An experiment in publishing code and words about code on a small scale." />

  <meta content="17715" name="octolytics-dimension-user_id" /><meta content="raganwald" name="octolytics-dimension-user_login" /><meta content="68647" name="octolytics-dimension-repository_id" /><meta content="raganwald/homoiconic" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="68647" name="octolytics-dimension-repository_network_root_id" /><meta content="raganwald/homoiconic" name="octolytics-dimension-repository_network_root_nwo" />
  <link href="https://github.com/raganwald/homoiconic/commits/master.atom" rel="alternate" title="Recent Commits to homoiconic:master" type="application/atom+xml" />

  </head>


  <body class="logged_out page-blob  vis-public env-production ">

    <div class="wrapper">
      
      
      


      
      <div class="header header-logged-out">
  <div class="container clearfix">

    <a class="header-logo-wordmark" href="https://github.com/">
      <span class="mega-octicon octicon-logo-github"></span>
    </a>

    <div class="header-actions">
        <a class="button primary" href="/signup">Sign up</a>
      <a class="button" href="/login?return_to=%2Fraganwald%2Fhomoiconic%2Fblob%2Fmaster%2F2010%2F10%2Flet.md">Sign in</a>
    </div>

    <div class="command-bar js-command-bar  in-repository">


      <ul class="top-nav">
          <li class="explore"><a href="/explore">Explore</a></li>
        <li class="features"><a href="/features">Features</a></li>
          <li class="enterprise"><a href="https://enterprise.github.com/">Enterprise</a></li>
          <li class="blog"><a href="/blog">Blog</a></li>
      </ul>
        <form accept-charset="UTF-8" action="/search" class="command-bar-form" id="top_search_form" method="get">

<input type="text" data-hotkey="/ s" name="q" id="js-command-bar-field" placeholder="Search or type a command" tabindex="1" autocapitalize="off"
    
    
      data-repo="raganwald/homoiconic"
      data-branch="master"
      data-sha="dc5d46c4dc00d6616a6c37a9388285562ef05aaf"
  >

    <input type="hidden" name="nwo" value="raganwald/homoiconic" />

    <div class="select-menu js-menu-container js-select-menu search-context-select-menu">
      <span class="minibutton select-menu-button js-menu-target">
        <span class="js-select-button">This repository</span>
      </span>

      <div class="select-menu-modal-holder js-menu-content js-navigation-container">
        <div class="select-menu-modal">

          <div class="select-menu-item js-navigation-item js-this-repository-navigation-item selected">
            <span class="select-menu-item-icon octicon octicon-check"></span>
            <input type="radio" class="js-search-this-repository" name="search_target" value="repository" checked="checked" />
            <div class="select-menu-item-text js-select-button-text">This repository</div>
          </div> <!-- /.select-menu-item -->

          <div class="select-menu-item js-navigation-item js-all-repositories-navigation-item">
            <span class="select-menu-item-icon octicon octicon-check"></span>
            <input type="radio" name="search_target" value="global" />
            <div class="select-menu-item-text js-select-button-text">All repositories</div>
          </div> <!-- /.select-menu-item -->

        </div>
      </div>
    </div>

  <span class="octicon help tooltipped downwards" title="Show command bar help">
    <span class="octicon octicon-question"></span>
  </span>


  <input type="hidden" name="ref" value="cmdform">

</form>
    </div>

  </div>
</div>


      


          <div class="site" itemscope itemtype="http://schema.org/WebPage">
    
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        

<ul class="pagehead-actions">


  <li>
  <a href="/login?return_to=%2Fraganwald%2Fhomoiconic"
  class="minibutton with-count js-toggler-target star-button entice tooltipped upwards "
  title="You must be signed in to use this feature" rel="nofollow">
  <span class="octicon octicon-star"></span>Star
</a>
<a class="social-count js-social-count" href="/raganwald/homoiconic/stargazers">
  1,557
</a>

  </li>

    <li>
      <a href="/login?return_to=%2Fraganwald%2Fhomoiconic"
        class="minibutton with-count js-toggler-target fork-button entice tooltipped upwards"
        title="You must be signed in to fork a repository" rel="nofollow">
        <span class="octicon octicon-git-branch"></span>Fork
      </a>
      <a href="/raganwald/homoiconic/network" class="social-count">
        91
      </a>
    </li>
</ul>

        <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
          <span class="repo-label"><span>public</span></span>
          <span class="mega-octicon octicon-repo"></span>
          <span class="author">
            <a href="/raganwald" class="url fn" itemprop="url" rel="author"><span itemprop="title">raganwald</span></a></span
          ><span class="repohead-name-divider">/</span><strong
          ><a href="/raganwald/homoiconic" class="js-current-repository js-repo-home-link">homoiconic</a></strong>

          <span class="page-context-loader">
            <img alt="Octocat-spinner-32" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
          </span>

        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">

      <div class="repository-with-sidebar repo-container ">

        <div class="repository-sidebar">
            

<div class="repo-nav repo-nav-full js-repository-container-pjax js-octicon-loaders">
  <div class="repo-nav-contents">
    <ul class="repo-menu">
      <li class="tooltipped leftwards" title="Code">
        <a href="/raganwald/homoiconic" aria-label="Code" class="js-selected-navigation-item selected" data-gotokey="c" data-pjax="true" data-selected-links="repo_source repo_downloads repo_commits repo_tags repo_branches /raganwald/homoiconic">
          <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

        <li class="tooltipped leftwards" title="Issues">
          <a href="/raganwald/homoiconic/issues" aria-label="Issues" class="js-selected-navigation-item js-disable-pjax" data-gotokey="i" data-selected-links="repo_issues /raganwald/homoiconic/issues">
            <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
            <span class='counter'>10</span>
            <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>        </li>

      <li class="tooltipped leftwards" title="Pull Requests"><a href="/raganwald/homoiconic/pulls" aria-label="Pull Requests" class="js-selected-navigation-item js-disable-pjax" data-gotokey="p" data-selected-links="repo_pulls /raganwald/homoiconic/pulls">
            <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull Requests</span>
            <span class='counter'>6</span>
            <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>


    </ul>
    <div class="repo-menu-separator"></div>
    <ul class="repo-menu">

      <li class="tooltipped leftwards" title="Pulse">
        <a href="/raganwald/homoiconic/pulse" aria-label="Pulse" class="js-selected-navigation-item " data-pjax="true" data-selected-links="pulse /raganwald/homoiconic/pulse">
          <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

      <li class="tooltipped leftwards" title="Graphs">
        <a href="/raganwald/homoiconic/graphs" aria-label="Graphs" class="js-selected-navigation-item " data-pjax="true" data-selected-links="repo_graphs repo_contributors /raganwald/homoiconic/graphs">
          <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

      <li class="tooltipped leftwards" title="Network">
        <a href="/raganwald/homoiconic/network" aria-label="Network" class="js-selected-navigation-item js-disable-pjax" data-selected-links="repo_network /raganwald/homoiconic/network">
          <span class="octicon octicon-git-branch"></span> <span class="full-word">Network</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

    </ul>

  </div>
</div>

            <div class="only-with-full-nav">
              

  

<div class="clone-url open"
  data-protocol-type="http"
  data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=clone">
  <h3><strong>HTTPS</strong> clone URL</h3>

  <input type="text" class="clone js-url-field"
         value="https://github.com/raganwald/homoiconic.git" readonly="readonly">

  <span class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="https://github.com/raganwald/homoiconic.git" data-copied-hint="copied!" title="copy to clipboard"><span class="octicon octicon-clippy"></span></span>
</div>

  

<div class="clone-url "
  data-protocol-type="subversion"
  data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=clone">
  <h3><strong>Subversion</strong> checkout URL</h3>

  <input type="text" class="clone js-url-field"
         value="https://github.com/raganwald/homoiconic" readonly="readonly">

  <span class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="https://github.com/raganwald/homoiconic" data-copied-hint="copied!" title="copy to clipboard"><span class="octicon octicon-clippy"></span></span>
</div>



<p class="clone-options">You can clone with
    <a href="#" class="js-clone-selector" data-protocol="http">HTTPS</a>,
    <a href="#" class="js-clone-selector" data-protocol="subversion">Subversion</a>,
  and <a href="https://help.github.com/articles/which-remote-url-should-i-use">other methods.</a>
</p>



                <a href="/raganwald/homoiconic/archive/master.zip"
                   class="minibutton sidebar-button"
                   title="Download this repository as a zip file"
                   rel="nofollow">
                  <span class="octicon octicon-cloud-download"></span>
                  Download ZIP
                </a>
            </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container>
          


<!-- blob contrib key: blob_contributors:v21:e053c121a433c9e87d4248dbec30fb5e -->
<!-- blob contrib frag key: views10/v8/blob_contributors:v21:e053c121a433c9e87d4248dbec30fb5e -->

<p title="This is a placeholder element" class="js-history-link-replace hidden"></p>

<a href="/raganwald/homoiconic/find/master" data-pjax data-hotkey="t" style="display:none">Show File Finder</a>

<div class="file-navigation">
  


<div class="select-menu js-menu-container js-select-menu" >
  <span class="minibutton select-menu-button js-menu-target" data-hotkey="w"
    data-master-branch="master"
    data-ref="master">
    <span class="octicon octicon-git-branch"></span>
    <i>branch:</i>
    <span class="js-select-button">master</span>
  </span>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax>

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <span class="select-menu-title">Switch branches/tags</span>
        <span class="octicon octicon-remove-close js-menu-close"></span>
      </div> <!-- /.select-menu-header -->

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" id="context-commitish-filter-field" class="js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" class="js-select-menu-tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" class="js-select-menu-tab">Tags</a>
            </li>
          </ul>
        </div><!-- /.select-menu-tabs -->
      </div><!-- /.select-menu-filters -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <div class="select-menu-item js-navigation-item selected">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/raganwald/homoiconic/blob/master/2010/10/let.md" class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target" data-name="master" data-skip-pjax="true" rel="nofollow" title="master">master</a>
            </div> <!-- /.select-menu-item -->
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/raganwald/homoiconic/blob/second.tag/2010/10/let.md" class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target" data-name="second.tag" data-skip-pjax="true" rel="nofollow" title="second.tag">second.tag</a>
            </div> <!-- /.select-menu-item -->
        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

    </div> <!-- /.select-menu-modal -->
  </div> <!-- /.select-menu-modal-holder -->
</div> <!-- /.select-menu -->

  <div class="breadcrumb">
    <span class='repo-root js-repo-root'><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/raganwald/homoiconic" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">homoiconic</span></a></span></span><span class="separator"> / </span><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/raganwald/homoiconic/tree/master/2010" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">2010</span></a></span><span class="separator"> / </span><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/raganwald/homoiconic/tree/master/2010/10" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">10</span></a></span><span class="separator"> / </span><strong class="final-path">let.md</strong> <span class="js-zeroclipboard minibutton zeroclipboard-button" data-clipboard-text="2010/10/let.md" data-copied-hint="copied!" title="copy to clipboard"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>


  
  <div class="commit file-history-tease">
    <img class="main-avatar" height="24" src="https://secure.gravatar.com/avatar/f8f7496052d3bf856e944aec64cfbb99?s=140&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="24" />
    <span class="author"><span rel="author">Reginald Braithwaite</span></span>
    <time class="js-relative-date" datetime="2013-02-03T19:49:44-08:00" title="2013-02-03 19:49:44">February 03, 2013</time>
    <div class="commit-title">
        <a href="/raganwald/homoiconic/commit/b2b5c4ad6069a537b0ca459b87dfcc9ac607a34c" class="message" data-pjax="true" title="shuffle">shuffle</a>
    </div>

    <div class="participation">
      <p class="quickstat"><a href="#blob_contributors_box" rel="facebox"><strong>2</strong> contributors</a></p>
          <a class="avatar tooltipped downwards" title="raganwald" href="/raganwald/homoiconic/commits/master/2010/10/let.md?author=raganwald"><img height="20" src="https://secure.gravatar.com/avatar/6944576a4252ea5303f0b978f8604a30?s=140&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="20" /></a>
    <a class="avatar tooltipped downwards" title="bkudria" href="/raganwald/homoiconic/commits/master/2010/10/let.md?author=bkudria"><img height="20" src="https://secure.gravatar.com/avatar/5b6484445948ebe063c264a1015dfcc4?s=140&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="20" /></a>


    </div>
    <div id="blob_contributors_box" style="display:none">
      <h2 class="facebox-header">Users who have contributed to this file</h2>
      <ul class="facebox-user-list">
        <li class="facebox-user-list-item">
          <img height="24" src="https://secure.gravatar.com/avatar/6944576a4252ea5303f0b978f8604a30?s=140&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="24" />
          <a href="/raganwald">raganwald</a>
        </li>
        <li class="facebox-user-list-item">
          <img height="24" src="https://secure.gravatar.com/avatar/5b6484445948ebe063c264a1015dfcc4?s=140&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png" width="24" />
          <a href="/bkudria">bkudria</a>
        </li>
      </ul>
    </div>
  </div>


<div id="files" class="bubble">
  <div class="file">
    <div class="meta">
      <div class="info">
        <span class="icon"><b class="octicon octicon-file-text"></b></span>
        <span class="mode" title="File Mode">file</span>
          <span>298 lines (205 sloc)</span>
        <span>15.613 kb</span>
      </div>
      <div class="actions">
        <div class="button-group">
              <a class="minibutton js-entice" href=""
                 data-entice="You must be signed in to make or propose changes">Edit</a>
          <a href="/raganwald/homoiconic/raw/master/2010/10/let.md" class="button minibutton " id="raw-url">Raw</a>
            <a href="/raganwald/homoiconic/blame/master/2010/10/let.md" class="button minibutton ">Blame</a>
          <a href="/raganwald/homoiconic/commits/master/2010/10/let.md" class="button minibutton " rel="nofollow">History</a>
        </div><!-- /.button-group -->
            <a class="minibutton danger empty-icon js-entice" href=""
               data-entice="You must be signed in and on a branch to make or propose changes">
            Delete
          </a>
      </div><!-- /.actions -->

    </div>
      
  <div id="readme" class="blob instapaper_body">
    <article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="lets-make-closures-easy" class="anchor" href="#lets-make-closures-easy"><span class="octicon octicon-link"></span></a>Let's make closures easy</h1>

<p>In <a href="http://japhr.blogspot.com/2010/10/gah-i-still-dont-know-closures.html">Gah! I Still Don't Know Closures</a>, Chris Strom refactored this JavaScript code:</p>

<pre><code>Frame.prototype.remove = function () {
  for (var i=0; i&lt;this.elements.length; i++) {
    this.elements[i].remove();
  };
};

Frame.prototype.show = function() {
  for (var i=0; i&lt;this.elements.length; i++) {
    this.elements[i].show();
  };
};

Frame.prototype.hide = function() {
  for (var i=0; i&lt;this.elements.length; i++) {
    this.elements[i].hide();
  };
};

Frame.prototype.stop = function() {
  for (var i=0; i&lt;this.elements.length; i++) {
    this.elements[i].stop();
  };
};
</code></pre>

<p>Into this:</p>

<pre><code>var methods = ['remove', 'show', 'hide', 'stop'];
for (var i=0; i&lt;methods.length; i++) {
  var method = methods[i];
  Frame.prototype[methods[i]] = function () {
    for (var j=0; j&lt;this.elements.length; j++) {
      this.elements[j][method]();
    };
  };
}
</code></pre>

<p>Alas, it didn't work right out of the gate, and Chris goes on to explain how he remedied the issue. If you haven't spotted the bug, you might want to try the following simplified version in Firebug or Safari's error console:</p>

<pre><code>function declareConjunctions () {
  var conjunctions = ['before', 'after', 'below', 'above', 'inside', 'outside'];

  for (var i=0; i&lt;conjunctions.length; i++) {
    var conjunction = conjunctions[i];
    String.prototype[conjunctions[i]] = function (that) {
      return this + ' ' + conjunction + ' ' + that;
    };
  }
}
</code></pre>

<p>And here's what's wrong:</p>

<pre><code>declareConjunctions();

"miles davis".before("wynton marsalis")
  =&gt; "miles davis outside wynton marsalis"

"head".inside("hat")
  =&gt; "head outside hat"
</code></pre>

<p>Hmmm.</p>

<p><strong>the problem</strong></p>

<p>Let's start by diagnosing the issue. We're defining six new methods for <code>String</code> instances. Unlike Ruby, methods in JavaScript and functions in JavaScript are the exact same thing, so we can also say that we're creating six new functions, one for each element in the conjunctions array. Note that it's technically wrong to say that we are creating one function. We're creating six different functions, one each time the JavaScript interpreter encounters the <code>function</code> keyword.</p>

<p>Inside each of our six functions, we refer to the variable <code>conjunction</code>. JavaScript correctly notes that this refers to the variable defined outside of the function in the line <code>var conjunction = conjunctions[i];</code>. <code>conjunction</code> has a different value each time we create a new function, so we might think that when each of our functions are invoked they will refer to its value when the function was created.</p>

<p>This is not the case. Each of our functions simply stores a reference to the variable <code>conjunction</code> and when the function is invoked, it looks up the value at invocation time, not definition time. Its value at function definition time is irrelevant.</p>

<p>The easiest way to fix this problem is to make sure that each of the six functions we create has their own <code>conjunction</code> variable rather than having them all share the same variable.</p>

<blockquote>
<p>Practice explaining code to others is one of the keys to improving your ability to write self-explanatory code.</p>
</blockquote>

<p>This brings us to the key question: <em>When do we create a new variable in JavaScript</em>? Most of you probably consider this question ridiculously trivial to understand, but let's work out how to explain it. You never know when you'll have to explain your code to someone else. The ideal code is self-explanatory, and practice explaining code to others is one of the keys to improving your ability to write self-explanatory code.</p>

<p>Let's look at this code again, simplified greatly:</p>

<pre><code>function declareConjunctions () {
  // ...
  for (/* ... */) {
    var conjunction = // ...
    // ...
  }
}
</code></pre>

<p>It appears as if we're using the <code>var</code> keyword to create a new variable each time through the for loop. <em>But this is not so</em>. To understand this issue, we really have to understand when the JavaScript interpreter creates a new variable and when it simply assigns a value to an existing variable.</p>

<p><a href="http://dansbirdingblog.blogspot.com/2010/01/urban-thrushes-whooper-and-nice-goose.html" title="Urban Thrushes, a Whooper, and a Nice Goose"><img src="https://github-camo.global.ssl.fastly.net/7015040beb7ae6d8d2567d275deb43bf8e4a632c/687474703a2f2f322e62702e626c6f6773706f742e636f6d2f5f4a72584f7159574e666a632f53306e357970346b6865492f41414141414141414231342f6964396a5f6437745949512f733430302f52656477696e675f41726c657365795f323031304a616e31302e6a7067" height="432" width="500" style="max-width:100%;"></a></p>

<p><strong>scope</strong></p>

<p>When is a new variable created? Well, the interpreter might do one thing, it might do another, but in practice it is sufficient to say the following:</p>

<p><em>A new variable is created for each parameter and every variable declared with the <code>var</code> keyword every time a function is invoked.</em></p>

<p>Note that if a function is invoked 100 times, each of its parameters will actually create 100 different new variables even though all 100 share the same name in the code. We say that parameters in JavaScript have <em>function scope</em>. My mental model is that when a function is invoked, JavaScript creates a new dictionary of variables and values. The first thing it does is make entries for each of the parameters. Some other part of the program might have variables with the same name (common variables like "i," "key," or "value" might exist in many different dictionaries), but since those variables are written in different dictionaries, they don't conflict with our variables.</p>

<p>Variables created with the <code>var</code> keyword also have function scope. When the JavaScript interpreter is first parsing a function declaration, it searches for <code>var</code> keywords. These are "hoisted" to the beginning of the function that immediately encloses them. So if you write this:</p>

<pre><code>function declareConjunctions () {
  var conjunctions = ['before', 'after', 'below', 'above', 'inside', 'outside'];

  for (var i=0; i&lt;conjunctions.length; i++) {
    var conjunction = conjunctions[i];
    String.prototype[conjunctions[i]] = function (that) {
      return this + ' ' + conjunction + ' ' + that;
    };
  }
}
</code></pre>

<p>The interpreter rearranges things so it looks like this:</p>

<pre><code>function declareConjunctions () {
  var conjunctions, conjunction;

  conjunctions = ['before', 'after', 'below', 'above', 'inside', 'outside'];

  for (var i=0; i&lt;conjunctions.length; i++) {
    conjunction = conjunctions[i];
    String.prototype[conjunctions[i]] = function (that) {
      return this + ' ' + conjunction + ' ' + that;
    };
  }
}
</code></pre>

<p>Now it's very obvious that there is one and only only one <code>conjunction</code> variable created when you invoke <code>declareConjunctions</code>. The fact that the <code>var</code> keyword was placed inside a for loop is irrelevant. After the interpreter has created dictionary entries for each of the parameters, it creates dictionary entries for each of the "hoisted" variables declared with <code>var</code>.</p>

<p>So is a dictionary a scope? Not quite. We've written about creating variables. What about looking up their values? When a variable is used, javascript looks it up in the current dictionary. If it isn't in the dictionary, JavaScript looks in the dictionary for whatever function was invoked when the current function was <em>created</em>. Not invoked, created. If it isn't there, JavaScript repeats the process until it is looking in a top-level dictionary that represents code running when JavaScript was first invoked.</p>

<p>The dictionaries can be thought to nest, but I prefer to think of them as having a parent-child relationship. Invoking a function creates a new dictionary, but the new dictionary is the child of the code that created the function, not the code that invokes the function.</p>

<p>The chain of dictionaries is called a <em>scope</em>. In practice, making dictionaries children of the dictionary for the function that creates another function makes it easy to determine where a variable is defined by examining the lexical form of the source code statically. Thus, this style of scoping is called <strong>Lexical Scope</strong>.</p>

<p>We take lexical scope for granted with JavaScript: When our function refers to the <code>conjunction</code> variable, we look for its definition right there in the code surrounding the function. That's lexical scoping in action. (There is another way to do things, Dynamic Scoping, where a scope is the child of the scope of the code that invokes a function. Im that case, <code>conjunction</code> would have to be defined by whatever code invokes <code>"christian mcbride".after("jaco pastorius")</code>. If that seems impossibly contrived, consider that exception handling is dynamically scoped and people find ways to make it useful.)</p>

<p><strong>solving the problem</strong></p>

<p>Now that we've examined javascript's lexical scope in detail, we have a solution. If we want different values for <code>conjunction</code> each time we create a new function, we need different variables each time through the for loop. To create new variables, we have to invoke a new function each time though the for loop. </p>

<p>Here's the simplest refactoring, the one that minimizes rearranging our code:</p>

<pre><code>function declareConjunctions () {
  var conjunctions = ['before', 'after', 'below', 'above', 'inside', 'outside'];
  for (var i=0; i&lt;conjunctions.length; i++) {
    (function () {
      var conjunction = conjunctions[i];
      String.prototype[conjunctions[i]] = function (that) {
        return this + ' ' + conjunction + ' ' + that;
      };
    })();
  }
}
</code></pre>

<p>Now we get the expected behaviour:</p>

<pre><code>declareConjunctions();

"miles davis".before("wynton marsalis")
  =&gt; "miles davis before wynton marsalis"

"head".inside("hat")
  =&gt; "head inside hat"
</code></pre>

<p>Why did this work? Well, let's look at what we added:</p>

<pre><code>(function () {
  var conjunction = conjunctions[i];
  // blah, blah
})();
</code></pre>

<p>Each time through the for loop, we're creating a new, anonymous function <em>with the definition of <code>conjunction</code> inside that function's body</em>. We then invoke the function immediately, which creates a new scope. The <code>var</code> keyword creates a new variable in each scope, and we thus get six different variables, each of which has its own value. Let's look at what the interpreter does when it "hoists" our variable:</p>

<pre><code>function declareConjunctions () {
  var conjunctions;

  conjunctions = ['before', 'after', 'below', 'above', 'inside', 'outside'];

  for (var i=0; i&lt;conjunctions.length; i++) {
    (function () {
      var conjunction;

      conjunction = conjunctions[i];
      String.prototype[conjunctions[i]] = function (that) {
        return this + ' ' + conjunction + ' ' + that;
      };
    })();
  }
}
</code></pre>

<p>This solves our problem, because adding a new function inside the for loop means that the closest function definition is inside the for loop, which is where the interpreter hoists the variable declaration.</p>

<p>The pattern of defining variables inside of an anonymous function that is immediately invoked is very useful. Amongst other things, it's handy for keeping the global namespace clean or creating private variables. And there's another way to use an anonymous function to create new variables. Here's a function that counts:</p>

<pre><code>var count = (function (counter) {
  return function () {
    return ++counter;
  }
})(0);

count()
  =&gt; 1

count()
  =&gt; 2
</code></pre>

<p>You recall that parameters create new variables as well. I prefer this strongly because I know that the creation of the function is what establishes a new scope, and a function's parameters are sitting right there in its definition.</p>

<p>I'm not alone in my madness. Here is a common abbreviation pattern:</p>

<pre><code>(function ($,F) {

  // blah, blah, blah

})(jQuery, Functional);
</code></pre>

<p>This binds <code>$</code> and <code>F</code> without conflicting with other libraries that may want to define <code>$</code> or <code>F</code> for their own purposes. The only trouble with structuring things as parameters is that in JavaScript, the definition of the parameter and the value it is passed can be a long way away from each other.</p>

<p><a href="http://dansbirdingblog.blogspot.com/2010/01/urban-thrushes-whooper-and-nice-goose.html" title="Urban Thrushes, a Whooper, and a Nice Goose"><img src="https://github-camo.global.ssl.fastly.net/65398266d5f2799032ad2af481581aa7036ae78e/687474703a2f2f312e62702e626c6f6773706f742e636f6d2f5f4a72584f7159574e666a632f53306e355575667a656f492f41414141414141414231492f59354f70654957505532632f73313630302f4669656c6466617265315f41726c657365795f323031304a616e31302e6a7067" height="427" width="500" style="max-width:100%;"></a></p>

<p><strong>let's get closer</strong></p>

<p>If you prefer to keep your parameters closer to the values you are going to bind, we can use a JavaScript version of the <a href="http://github.com/raganwald/homoiconic/blob/master/2008-10-30/thrush.markdown#readme">Thrush Combinator</a>, <code>let</code>:</p>

<pre><code>var let = function () {
  var body = arguments[arguments.length-1];
  return body.apply(this, Array.prototype.slice.call(arguments, 0, arguments.length - 1));
}
</code></pre>

<p>This lets us write:</p>

<pre><code>var count = let(0, function (counter) {
  return function () {
    return ++counter;
  }
});
</code></pre>

<p>And:</p>

<pre><code>let(jQuery, Functional, function ($, F) {

  // blah, blah, blah

});
</code></pre>

<p>Not to mention:</p>

<pre><code>for (var i=0; i&lt;conjunctions.length; i++) {
  let(conjunctions[i], function (conjunction) {
    String.prototype[conjunctions[i]] = function (that) {
      return this + ' ' + conjunction + ' ' + that;
    };
  });
}
</code></pre>

<p>And finally:</p>

<pre><code>var methods = ['remove', 'show', 'hide', 'stop'];
for (var i=0; i&lt;methods.length; i++) {
  let(methods[i], function (method) {
    Frame.prototype[methods[i]] = function () {
      for (var j=0; j&lt;this.elements.length; j++) {
        this.elements[j][method]();
      };
    };
  });
} 
</code></pre>

<p>Is <code>let</code> worth the bother? I think so. Although I've been using anonymous functions to establish scopes for a very long time, I realize that it isn't always immediately obvious what the code is doing. <code>let</code> is arresting: It reads in English "Let these values be assigned to these variables..." and makes a nice little obvious place that we are making a new scope.</p>

<p>And I suppose we shouldn't be making long functions, but even on a short function I prefer the values and the bindings be kept close together. Declaring variables inside a scope avoids that issue, but I strongly prefer using parameters when I want to create a new scope. The parameter variable is very close to the <code>function</code> keyword what establishes the scope, and that makes the code very easy to understand.</p>

<p>But the very best reason for using <code>let</code> is that <a href="https://developer.mozilla.org/en/New_in_JavaScript_1.7#let_statement">JavaScript 1.7 includes a <code>let</code> keyword</a>! Knowing that you'll be using <code>let</code> eventually, why get in the habit now?</p>

<hr><p>p.s. A proggit reader <a href="http://www.reddit.com/r/programming/comments/dn4ra/lets_make_closures_easy/c11fv9e">brings up a good point</a>: <em>Closures</em> are a means of implementing <em>lexical scope</em>. Closures are an implementation mechanism, not a language feature.</p>

<p>p.p.s. There's an excellent discussion of variable hoisting in <a href="http://www.nczonline.net/blog/2010/01/26/answering-baranovskiys-javascript-quiz/" title="Answering Baranovskiy's JavaScript Quiz">this excellent article</a>.</p>

<p>NEW! <a href="http://leanpub.com/combinators">Kestrels, Quirky Birds, and Hopeless Egocentricity</a>, all of my writing about combinators, collected into one conevnient and inexpensive e-book!</p>

<hr><p>(Spot a bug or a spelling mistake? This is a Github repo, fork it and send me a pull request!)</p>

<p><a href="http://braythwayt.com">Reg Braithwaite</a> | <a href="http://twitter.com/raganwald">@raganwald</a></p></article>
  </div>

  </div>
</div>

<a href="#jump-to-line" rel="facebox[.linejump]" data-hotkey="l" class="js-jump-to-line" style="display:none">Jump to Line</a>
<div id="jump-to-line" style="display:none">
  <form accept-charset="UTF-8" class="js-jump-to-line-form">
    <input class="linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" autofocus>
    <button type="submit" class="button">Go</button>
  </form>
</div>

        </div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer">
    <ul class="site-footer-links right">
      <li><a href="https://status.github.com/">Status</a></li>
      <li><a href="http://developer.github.com">API</a></li>
      <li><a href="http://training.github.com">Training</a></li>
      <li><a href="http://shop.github.com">Shop</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/about">About</a></li>

    </ul>

    <a href="/">
      <span class="mega-octicon octicon-mark-github"></span>
    </a>

    <ul class="site-footer-links">
      <li>&copy; 2013 <span title="0.04439s from fe3.rs.github.com">GitHub</span>, Inc.</li>
        <li><a href="/site/terms">Terms</a></li>
        <li><a href="/site/privacy">Privacy</a></li>
        <li><a href="/security">Security</a></li>
        <li><a href="/contact">Contact</a></li>
    </ul>
  </div><!-- /.site-footer -->
</div><!-- /.container -->


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-fullscreen-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="js-fullscreen-contents" placeholder="" data-suggester="fullscreen_suggester"></textarea>
          <div class="suggester-container">
              <div class="suggester fullscreen-suggester js-navigation-container" id="fullscreen_suggester"
                 data-url="/raganwald/homoiconic/suggestions/commit">
              </div>
          </div>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="#" class="exit-fullscreen js-exit-fullscreen tooltipped leftwards" title="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="#" class="theme-switcher js-theme-switcher tooltipped leftwards"
      title="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="#" class="octicon octicon-remove-close close ajax-error-dismiss"></a>
      Something went wrong with that request. Please try again.
    </div>

    
  </body>
</html>

